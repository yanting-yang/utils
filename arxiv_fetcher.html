<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>arXiv Fetcher</title>
    <style>
        .tabs{display:flex}
        .tab-btn.active{font-weight:bold}
        .tab-content{display:none;overflow:auto;position:relative}
        .tab-content.active{display:block}
        pre{white-space:pre-wrap;word-wrap:break-word}
        .copy-btn{position:absolute;top:5px;right:5px}
    </style>
</head>
<body>
    <nav><a href="index.html">Home</a></nav>
    <h1>arXiv Fetcher</h1>

    <fieldset>
        <legend>Step 1: Set Parameters</legend>
        <label>Categories (select multiple):</label>
        <div id="categoryContainer" style="font-size:0.9em;">
            <!-- Computer Science -->
            <details open><summary><strong>Computer Science (cs)</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="cs.*"><strong> cs.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="cs.AI"> cs.AI</label>
                <label><input type="checkbox" name="category" value="cs.AR"> cs.AR</label>
                <label><input type="checkbox" name="category" value="cs.CC"> cs.CC</label>
                <label><input type="checkbox" name="category" value="cs.CE"> cs.CE</label>
                <label><input type="checkbox" name="category" value="cs.CG"> cs.CG</label>
                <label><input type="checkbox" name="category" value="cs.CL"> cs.CL</label>
                <label><input type="checkbox" name="category" value="cs.CR"> cs.CR</label>
                <label><input type="checkbox" name="category" value="cs.CV"> cs.CV</label>
                <label><input type="checkbox" name="category" value="cs.CY"> cs.CY</label>
                <label><input type="checkbox" name="category" value="cs.DB"> cs.DB</label>
                <label><input type="checkbox" name="category" value="cs.DC"> cs.DC</label>
                <label><input type="checkbox" name="category" value="cs.DL"> cs.DL</label>
                <label><input type="checkbox" name="category" value="cs.DM"> cs.DM</label>
                <label><input type="checkbox" name="category" value="cs.DS"> cs.DS</label>
                <label><input type="checkbox" name="category" value="cs.ET"> cs.ET</label>
                <label><input type="checkbox" name="category" value="cs.FL"> cs.FL</label>
                <label><input type="checkbox" name="category" value="cs.GL"> cs.GL</label>
                <label><input type="checkbox" name="category" value="cs.GR"> cs.GR</label>
                <label><input type="checkbox" name="category" value="cs.GT"> cs.GT</label>
                <label><input type="checkbox" name="category" value="cs.HC"> cs.HC</label>
                <label><input type="checkbox" name="category" value="cs.IR"> cs.IR</label>
                <label><input type="checkbox" name="category" value="cs.IT"> cs.IT</label>
                <label><input type="checkbox" name="category" value="cs.LG"> cs.LG</label>
                <label><input type="checkbox" name="category" value="cs.LO"> cs.LO</label>
                <label><input type="checkbox" name="category" value="cs.MA"> cs.MA</label>
                <label><input type="checkbox" name="category" value="cs.MM"> cs.MM</label>
                <label><input type="checkbox" name="category" value="cs.MS"> cs.MS</label>
                <label><input type="checkbox" name="category" value="cs.NA"> cs.NA</label>
                <label><input type="checkbox" name="category" value="cs.NE"> cs.NE</label>
                <label><input type="checkbox" name="category" value="cs.NI"> cs.NI</label>
                <label><input type="checkbox" name="category" value="cs.OH"> cs.OH</label>
                <label><input type="checkbox" name="category" value="cs.OS"> cs.OS</label>
                <label><input type="checkbox" name="category" value="cs.PF"> cs.PF</label>
                <label><input type="checkbox" name="category" value="cs.PL"> cs.PL</label>
                <label><input type="checkbox" name="category" value="cs.RO"> cs.RO</label>
                <label><input type="checkbox" name="category" value="cs.SC"> cs.SC</label>
                <label><input type="checkbox" name="category" value="cs.SD"> cs.SD</label>
                <label><input type="checkbox" name="category" value="cs.SE"> cs.SE</label>
                <label><input type="checkbox" name="category" value="cs.SI"> cs.SI</label>
                <label><input type="checkbox" name="category" value="cs.SY"> cs.SY</label>
            </div></details>
            <!-- Economics -->
            <details><summary><strong>Economics (econ)</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="econ.*"><strong> econ.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="econ.EM"> econ.EM</label>
                <label><input type="checkbox" name="category" value="econ.GN"> econ.GN</label>
                <label><input type="checkbox" name="category" value="econ.TH"> econ.TH</label>
            </div></details>
            <!-- Electrical Engineering and Systems Science -->
            <details><summary><strong>Electrical Engineering and Systems Science (eess)</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="eess.*"><strong> eess.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="eess.AS"> eess.AS</label>
                <label><input type="checkbox" name="category" value="eess.IV"> eess.IV</label>
                <label><input type="checkbox" name="category" value="eess.SP"> eess.SP</label>
                <label><input type="checkbox" name="category" value="eess.SY"> eess.SY</label>
            </div></details>
            <!-- Mathematics -->
            <details><summary><strong>Mathematics (math)</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="math.*"><strong> math.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="math.AC"> math.AC</label>
                <label><input type="checkbox" name="category" value="math.AG"> math.AG</label>
                <label><input type="checkbox" name="category" value="math.AP"> math.AP</label>
                <label><input type="checkbox" name="category" value="math.AT"> math.AT</label>
                <label><input type="checkbox" name="category" value="math.CA"> math.CA</label>
                <label><input type="checkbox" name="category" value="math.CO"> math.CO</label>
                <label><input type="checkbox" name="category" value="math.CT"> math.CT</label>
                <label><input type="checkbox" name="category" value="math.CV"> math.CV</label>
                <label><input type="checkbox" name="category" value="math.DG"> math.DG</label>
                <label><input type="checkbox" name="category" value="math.DS"> math.DS</label>
                <label><input type="checkbox" name="category" value="math.FA"> math.FA</label>
                <label><input type="checkbox" name="category" value="math.GM"> math.GM</label>
                <label><input type="checkbox" name="category" value="math.GN"> math.GN</label>
                <label><input type="checkbox" name="category" value="math.GR"> math.GR</label>
                <label><input type="checkbox" name="category" value="math.GT"> math.GT</label>
                <label><input type="checkbox" name="category" value="math.HO"> math.HO</label>
                <label><input type="checkbox" name="category" value="math.IT"> math.IT</label>
                <label><input type="checkbox" name="category" value="math.KT"> math.KT</label>
                <label><input type="checkbox" name="category" value="math.LO"> math.LO</label>
                <label><input type="checkbox" name="category" value="math.MG"> math.MG</label>
                <label><input type="checkbox" name="category" value="math.MP"> math.MP</label>
                <label><input type="checkbox" name="category" value="math.NA"> math.NA</label>
                <label><input type="checkbox" name="category" value="math.NT"> math.NT</label>
                <label><input type="checkbox" name="category" value="math.OA"> math.OA</label>
                <label><input type="checkbox" name="category" value="math.OC"> math.OC</label>
                <label><input type="checkbox" name="category" value="math.PR"> math.PR</label>
                <label><input type="checkbox" name="category" value="math.QA"> math.QA</label>
                <label><input type="checkbox" name="category" value="math.RA"> math.RA</label>
                <label><input type="checkbox" name="category" value="math.RT"> math.RT</label>
                <label><input type="checkbox" name="category" value="math.SG"> math.SG</label>
                <label><input type="checkbox" name="category" value="math.SP"> math.SP</label>
                <label><input type="checkbox" name="category" value="math.ST"> math.ST</label>
            </div></details>
            <!-- Physics -->
            <details><summary><strong>Physics</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="astro-ph.*"><strong> astro-ph.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="cond-mat.*"><strong> cond-mat.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="nlin.*"><strong> nlin.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="physics.*"><strong> physics.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="astro-ph.CO"> astro-ph.CO</label>
                <label><input type="checkbox" name="category" value="astro-ph.EP"> astro-ph.EP</label>
                <label><input type="checkbox" name="category" value="astro-ph.GA"> astro-ph.GA</label>
                <label><input type="checkbox" name="category" value="astro-ph.HE"> astro-ph.HE</label>
                <label><input type="checkbox" name="category" value="astro-ph.IM"> astro-ph.IM</label>
                <label><input type="checkbox" name="category" value="astro-ph.SR"> astro-ph.SR</label>
                <label><input type="checkbox" name="category" value="cond-mat.dis-nn"> cond-mat.dis-nn</label>
                <label><input type="checkbox" name="category" value="cond-mat.mes-hall"> cond-mat.mes-hall</label>
                <label><input type="checkbox" name="category" value="cond-mat.mtrl-sci"> cond-mat.mtrl-sci</label>
                <label><input type="checkbox" name="category" value="cond-mat.other"> cond-mat.other</label>
                <label><input type="checkbox" name="category" value="cond-mat.quant-gas"> cond-mat.quant-gas</label>
                <label><input type="checkbox" name="category" value="cond-mat.soft"> cond-mat.soft</label>
                <label><input type="checkbox" name="category" value="cond-mat.stat-mech"> cond-mat.stat-mech</label>
                <label><input type="checkbox" name="category" value="cond-mat.str-el"> cond-mat.str-el</label>
                <label><input type="checkbox" name="category" value="cond-mat.supr-con"> cond-mat.supr-con</label>
                <label><input type="checkbox" name="category" value="gr-qc"> gr-qc</label>
                <label><input type="checkbox" name="category" value="hep-ex"> hep-ex</label>
                <label><input type="checkbox" name="category" value="hep-lat"> hep-lat</label>
                <label><input type="checkbox" name="category" value="hep-ph"> hep-ph</label>
                <label><input type="checkbox" name="category" value="hep-th"> hep-th</label>
                <label><input type="checkbox" name="category" value="math-ph"> math-ph</label>
                <label><input type="checkbox" name="category" value="nlin.AO"> nlin.AO</label>
                <label><input type="checkbox" name="category" value="nlin.CD"> nlin.CD</label>
                <label><input type="checkbox" name="category" value="nlin.CG"> nlin.CG</label>
                <label><input type="checkbox" name="category" value="nlin.PS"> nlin.PS</label>
                <label><input type="checkbox" name="category" value="nlin.SI"> nlin.SI</label>
                <label><input type="checkbox" name="category" value="nucl-ex"> nucl-ex</label>
                <label><input type="checkbox" name="category" value="nucl-th"> nucl-th</label>
                <label><input type="checkbox" name="category" value="physics.acc-ph"> physics.acc-ph</label>
                <label><input type="checkbox" name="category" value="physics.ao-ph"> physics.ao-ph</label>
                <label><input type="checkbox" name="category" value="physics.app-ph"> physics.app-ph</label>
                <label><input type="checkbox" name="category" value="physics.atm-clus"> physics.atm-clus</label>
                <label><input type="checkbox" name="category" value="physics.atom-ph"> physics.atom-ph</label>
                <label><input type="checkbox" name="category" value="physics.bio-ph"> physics.bio-ph</label>
                <label><input type="checkbox" name="category" value="physics.chem-ph"> physics.chem-ph</label>
                <label><input type="checkbox" name="category" value="physics.class-ph"> physics.class-ph</label>
                <label><input type="checkbox" name="category" value="physics.comp-ph"> physics.comp-ph</label>
                <label><input type="checkbox" name="category" value="physics.data-an"> physics.data-an</label>
                <label><input type="checkbox" name="category" value="physics.ed-ph"> physics.ed-ph</label>
                <label><input type="checkbox" name="category" value="physics.flu-dyn"> physics.flu-dyn</label>
                <label><input type="checkbox" name="category" value="physics.gen-ph"> physics.gen-ph</label>
                <label><input type="checkbox" name="category" value="physics.geo-ph"> physics.geo-ph</label>
                <label><input type="checkbox" name="category" value="physics.hist-ph"> physics.hist-ph</label>
                <label><input type="checkbox" name="category" value="physics.ins-det"> physics.ins-det</label>
                <label><input type="checkbox" name="category" value="physics.med-ph"> physics.med-ph</label>
                <label><input type="checkbox" name="category" value="physics.optics"> physics.optics</label>
                <label><input type="checkbox" name="category" value="physics.plasm-ph"> physics.plasm-ph</label>
                <label><input type="checkbox" name="category" value="physics.pop-ph"> physics.pop-ph</label>
                <label><input type="checkbox" name="category" value="physics.soc-ph"> physics.soc-ph</label>
                <label><input type="checkbox" name="category" value="physics.space-ph"> physics.space-ph</label>
                <label><input type="checkbox" name="category" value="quant-ph"> quant-ph</label>
            </div></details>
            <!-- Quantitative Biology -->
            <details><summary><strong>Quantitative Biology (q-bio)</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="q-bio.*"><strong> q-bio.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="q-bio.BM"> q-bio.BM</label>
                <label><input type="checkbox" name="category" value="q-bio.CB"> q-bio.CB</label>
                <label><input type="checkbox" name="category" value="q-bio.GN"> q-bio.GN</label>
                <label><input type="checkbox" name="category" value="q-bio.MN"> q-bio.MN</label>
                <label><input type="checkbox" name="category" value="q-bio.NC"> q-bio.NC</label>
                <label><input type="checkbox" name="category" value="q-bio.OT"> q-bio.OT</label>
                <label><input type="checkbox" name="category" value="q-bio.PE"> q-bio.PE</label>
                <label><input type="checkbox" name="category" value="q-bio.QM"> q-bio.QM</label>
                <label><input type="checkbox" name="category" value="q-bio.SC"> q-bio.SC</label>
                <label><input type="checkbox" name="category" value="q-bio.TO"> q-bio.TO</label>
            </div></details>
            <!-- Quantitative Finance -->
            <details><summary><strong>Quantitative Finance (q-fin)</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="q-fin.*"><strong> q-fin.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="q-fin.CP"> q-fin.CP</label>
                <label><input type="checkbox" name="category" value="q-fin.EC"> q-fin.EC</label>
                <label><input type="checkbox" name="category" value="q-fin.GN"> q-fin.GN</label>
                <label><input type="checkbox" name="category" value="q-fin.MF"> q-fin.MF</label>
                <label><input type="checkbox" name="category" value="q-fin.PM"> q-fin.PM</label>
                <label><input type="checkbox" name="category" value="q-fin.PR"> q-fin.PR</label>
                <label><input type="checkbox" name="category" value="q-fin.RM"> q-fin.RM</label>
                <label><input type="checkbox" name="category" value="q-fin.ST"> q-fin.ST</label>
                <label><input type="checkbox" name="category" value="q-fin.TR"> q-fin.TR</label>
            </div></details>
            <!-- Statistics -->
            <details><summary><strong>Statistics (stat)</strong></summary>
            <div>
                <label><input type="checkbox" name="category" value="stat.*"><strong> stat.* (All)</strong></label>
                <label><input type="checkbox" name="category" value="stat.AP"> stat.AP</label>
                <label><input type="checkbox" name="category" value="stat.CO"> stat.CO</label>
                <label><input type="checkbox" name="category" value="stat.ME"> stat.ME</label>
                <label><input type="checkbox" name="category" value="stat.ML"> stat.ML</label>
                <label><input type="checkbox" name="category" value="stat.OT"> stat.OT</label>
                <label><input type="checkbox" name="category" value="stat.TH"> stat.TH</label>
            </div></details>
        </div>
        <label>Max Results: <input type="number" id="maxResultsInput" value="10" min="1" max="2000"></label>
        <label>Sort By:
            <select id="sortBySelect">
                <option value="relevance">Relevance</option>
                <option value="lastUpdatedDate" selected>Last Updated Date</option>
                <option value="submittedDate">Submitted Date</option>
            </select>
        </label>
        <br>
        <button type="button" id="generateUrlBtn">Generate URL</button>
        <output id="urlDisplay"></output>
    </fieldset>

    <fieldset>
        <legend>Step 2: Fetch Data</legend>
        <button id="fetchBtn">Fetch Publications</button>
        using <a href="https://cors-anywhere.com/" target="_blank">CORS Anywhere</a> <b>OR</b> upload XML: <input type="file" id="xmlFileInput" accept=".xml">
        <output id="status"></output>
    </fieldset>

    <fieldset>
        <legend>Step 3: View Results</legend>
        <div class="tabs">
            <button class="tab-btn active" data-tab="xml">Raw XML</button>
            <button class="tab-btn" data-tab="json">JSON</button>
            <button class="tab-btn" data-tab="result">Parsed Result</button>
        </div>

        <section id="xml" class="tab-content active"><button class="copy-btn" data-target="xmlOutput">Copy</button><pre id="xmlOutput"></pre></section>
        <section id="json" class="tab-content"><button class="copy-btn" data-target="jsonOutput">Copy</button><pre id="jsonOutput"></pre></section>
        <section id="result" class="tab-content"><button class="copy-btn" data-target="resultOutput">Copy</button><pre id="resultOutput"></pre></section>
    </fieldset>

    <script>
        const $ = id => document.getElementById(id);
        const $$ = sel => document.querySelectorAll(sel);

        // Tab switching
        $$('.tab-btn').forEach(btn => btn.addEventListener('click', () => {
            $$('.tab-btn').forEach(b => b.classList.remove('active'));
            $$('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            $(btn.dataset.tab).classList.add('active');
        }));

        const PROXY_URL = 'https://cors-anywhere.com/';
        const ARXIV_BASE_URL = 'http://export.arxiv.org/api/query';

        function processXml(xml) {
            const [xmlOutput, jsonOutput, resultOutput] = ['xmlOutput', 'jsonOutput', 'resultOutput'].map($);
            xmlOutput.textContent = xml;

            const doc = new DOMParser().parseFromString(xml, 'application/xml');
            const jsonData = [...doc.querySelectorAll('entry')].map(entry => ({
                id: entry.querySelector('id')?.textContent ?? null,
                title: entry.querySelector('title')?.textContent?.trim() ?? null,
                updated: entry.querySelector('updated')?.textContent ?? null,
                published: entry.querySelector('published')?.textContent ?? null,
                summary: entry.querySelector('summary')?.textContent?.trim() ?? null,
                links: [...entry.querySelectorAll('link')].map(link => ({
                    href: link.getAttribute('href'),
                    rel: link.getAttribute('rel'),
                    type: link.getAttribute('type'),
                    title: link.getAttribute('title')
                })),
                categories: [...entry.querySelectorAll('category')].map(cat => ({
                    term: cat.getAttribute('term'),
                    scheme: cat.getAttribute('scheme')
                })),
                'arxiv:primary_category': entry.querySelector('primary_category')?.getAttribute('term') ?? null,
                'arxiv:comment': entry.querySelector('comment')?.textContent ?? null,
                authors: [...entry.querySelectorAll('author')].map(a => ({
                    name: a.querySelector('name')?.textContent ?? null
                }))
            }));

            jsonOutput.textContent = JSON.stringify(jsonData, null, 2);

            resultOutput.textContent = jsonData.map(({title, authors, summary}) =>
                `Title: ${title || 'N/A'}\n` +
                `Authors: ${authors.map(a => a.name).join(', ')}\n` +
                `Abstract: ${summary || 'N/A'}\n`
            ).join('\n') || 'No entries found.';

            return jsonData.length;
        }

        function generateArxivUrl() {
            // Get selected categories from checkboxes
            const selectedCats = [...document.querySelectorAll('input[name="category"]:checked')]
                .map(cb => cb.value);

            // Default to cs.* if nothing selected
            if (selectedCats.length === 0) {
                selectedCats.push('cs.*');
            }

            // Build search query with OR for multiple categories
            const catQuery = selectedCats.length === 1
                ? `cat:${selectedCats[0]}`
                : selectedCats.map(c => `cat:${c}`).join('+OR+');

            const maxResults = Math.min(2000, Math.max(1, +$('maxResultsInput').value || 10));
            const sortBy = $('sortBySelect').value;
            const arxivUrl = `${ARXIV_BASE_URL}?search_query=${catQuery}&max_results=${maxResults}&sortBy=${sortBy}`;
            $('urlDisplay').innerHTML = `<a href="${arxivUrl}" target="_blank">${arxivUrl}</a>`;
            return arxivUrl;
        }

        async function fetchArxiv() {
            const status = $('status');
            const arxivUrl = generateArxivUrl();

            status.textContent = 'Fetching data...';
            $('xmlOutput').textContent = $('jsonOutput').textContent = $('resultOutput').textContent = '';

            try {
                const response = await fetch(PROXY_URL + arxivUrl);
                if (!response.ok) {
                    throw new Error(response.status === 403
                        ? 'Access Denied. Please visit the CORS Anywhere demo page to request temporary access.'
                        : 'Network response was not ok: ' + response.statusText);
                }

                const xml = await response.text();
                const count = processXml(xml);
                status.textContent = `Done! Found ${count} entries.`;
            } catch (error) {
                status.textContent = 'Error: ' + error.message;
                console.error('Fetch error:', error);
            }
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const status = $('status');
            status.textContent = 'Reading file...';
            $('urlDisplay').textContent = `File: ${file.name}`;

            const reader = new FileReader();
            reader.onload = (evt) => {
                try {
                    const count = processXml(evt.target.result);
                    status.textContent = `Done! Found ${count} entries from file.`;
                } catch (error) {
                    status.textContent = 'Error parsing XML: ' + error.message;
                }
            };
            reader.onerror = () => status.textContent = 'Error reading file.';
            reader.readAsText(file);
        }

        // Copy button functionality
        $$('.copy-btn').forEach(btn => btn.addEventListener('click', async () => {
            const targetId = btn.dataset.target;
            const text = $(targetId).textContent;
            if (!text) return;
            try {
                await navigator.clipboard.writeText(text);
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            } catch (err) {
                btn.textContent = 'Failed';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            }
        }));

        $('generateUrlBtn').addEventListener('click', generateArxivUrl);
        $('fetchBtn').addEventListener('click', fetchArxiv);
        $('xmlFileInput').addEventListener('change', handleFileUpload);
    </script>
</body>
</html>
